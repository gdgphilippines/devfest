<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../bower_components/shadycss/apply-shim.html">

<!-- <link rel="import" href="../../../../bower_components/paper-ripple/paper-ripple.html"> -->
<link rel="import" href="../fonts/devfest-fonts.html">
<link rel="import" href="../icons/devfest-icons.html">
<link rel="import" href="../components/devfest-footer.html">
<link rel="import" href="../components/devfest-button.html">

<dom-module id="devfest-tickets-page">
  <template>
    <link rel="stylesheet" href="../styles/pages/_devfest-tickets-page.scss">

    <section class="section ticket-perks-container blue">
      <div class="ticket-perks-title section-title">
      </div>
      <div class="section-layout">
        <template is="dom-repeat" items="[[details]]">
          <div class="perk">
            <iron-icon icon="[[item.icon]]"></iron-icon>
            <p class="ticket">
              [[item.ticket]]
            </p>
            <p class="date">
              [[item.date]]
            </p>
          </div>
        </template>
      </div>
    </section>

    <section class="section payment-container">
      <div class="payment-title section-title">
      </div>
      <div class="section-layout">
        <div class="online-option">
        </div>
        <div class="offline-option">
        </div>
      </div>
    </section>

    <section class="section perks-container blue">
      <div class="perks-title section-title">
      </div>
      <div class="section-layout">
          <template is="dom-repeat" items="[[perks]]">
            <div class="perk">
              <iron-icon icon="[[item.icon]]"></iron-icon>
              <p class="text">
                [[item.text]]
              </p>
              <p class="sub">
                [[item.sub]]
              </p>
            </div>
          </template>
        </div>
    </section>

    <devfest-footer></devfest-footer>

  </template>
  <script>
    import marked from 'marked'
    (() => {
      class DevfestTicketsPage extends Polymer.Element {
        static get is () { return 'devfest-tickets-page' }

        static get properties () {
          return {
            perks: {
              type: Array,
              value: []
            },
            sessions: {
              type: Array,
              value: []
            },
            topics: {
              type: Array,
              value: []
            },
            importantDates: {
              type: Array,
              value: []
            }
          }
        }

        connectedCallback () {
          super.connectedCallback()
          this._fetchContent()
          // this._db = new PouchDB('devfest-landing-page', {auto_compaction: true})
          // this._fetchContent()
        }

        disconnectedCallback () {
          // this._db.close()
        }

        _fetchContent () {
          console.log('fetch')
          fetch(`https://raw.githubusercontent.com/gdgphilippines/devfestph2017-files/old-master/content/${this.nodeName.toLowerCase()}.md`)
          .then(res => {
            return res.text()
          })
          .then(body => {
            const contentArray = body.split('-----')
            contentArray.forEach(contentBody => {
              if (contentBody.trim()) {
                try {
                  const array = contentBody.split('=====')
                  const query = array[0].trim().split(':')[0].trim()
                  const type = array[0].trim().split(':')[1]
                  const content = array[1]
                  const node = this.shadowRoot.querySelector(query)
                  if (type && type.trim() === 'json') {
                    var prop = query
                    if (!prop) throw new Error('No property found: ' + array[0])
                    // console.log(content, prop, JSON.parse(content))
                    this._setProperty(prop, JSON.parse(content))
                    // console.log(this[prop])
                  } else if (node) {
                    node.innerHTML = marked(content)
                  }
                } catch (e) {
                  console.log(e, contentBody)
                }
              }
            })
          })
        }
      }

      window.customElements.define(DevfestTicketsPage.is, DevfestTicketsPage)
    })()
  </script>
</dom-module>
