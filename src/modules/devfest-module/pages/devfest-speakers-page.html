<link rel="import" href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../bower_components/shadycss/apply-shim.html">

<!-- <link rel="import" href="../../../../bower_components/paper-ripple/paper-ripple.html"> -->
<link rel="import" href="../fonts/devfest-fonts.html">
<link rel="import" href="../icons/devfest-icons.html">
<link rel="import" href="../components/devfest-footer.html">
<link rel="import" href="../components/devfest-button.html">

<dom-module id="devfest-speakers-page">
  <template>
    <link rel="stylesheet" href="../styles/pages/_devfest-speakers-page.scss">

    <header class="banner-container">
      <div class="banner-part banner-image">
      </div>
      <div class="banner-part banner">
      </div>
    </header>

    <section class="section perks-container blue">
      <div class="perks-title section-title">
      </div>
      <div class="section-layout">
        <template is="dom-repeat" items="[[perks]]">
          <div class="perk">
            <iron-icon icon="[[item.icon]]"></iron-icon>
            <p>
              [[item.text]]
            </p>
          </div>
        </template>
      </div>
    </section>

    <section class="section session-container">
      <div class="session-title section-title">
      </div>
      <div class="section-layout">
        <template is="dom-repeat" items="[[sessions]]">
          <div class="session">
            <iron-icon icon="[[item.icon]]"></iron-icon>
            <h2>[[item.title]]</h2>
            <p>
            <template is="dom-repeat" items="[[item.text]]" as="text">
              [[text]]<br/>
            </template>
            </p>
          </div>
        </template>
      </div>
    </section>

    <section class="section topics-container blue">
      <div class="topics-title section-title">
      </div>
      <div class="section-layout">
        <template is="dom-repeat" items="[[topics]]">
          <div class="topic-card">
            <iron-icon icon="[[item.icon]]"></iron-icon>
            <h2>[[item.title]]</h2>
            <p>
            <template is="dom-repeat" items="[[item.topics]]" as="text">
              [[text]]<br/>
            </template>
            </p>
          </div>
        </template>
      </div>
    </section>

    <section class="section important-dates-container">
      <div class="important-dates-title section-title">
      </div>
      <div class="important-dates">
        <template is="dom-repeat" items="[[importantDates]]">
          <div class="important-date">
            <div class="text">
              [[item.text]]
            </div>
            <div class="date">
              [[item.date]]
            </div>
          </div>
        </template>
      </div>
    </section>

    <devfest-footer></devfest-footer>

  </template>
  <script>
    import marked from 'marked'
    (() => {
      class DevfestCallForSpeakersPage extends Polymer.Element {
        static get is () { return 'devfest-speakers-page' }

        static get properties () {
          return {
            perks: {
              type: Array,
              value: []
            },
            sessions: {
              type: Array,
              value: []
            },
            topics: {
              type: Array,
              value: []
            },
            importantDates: {
              type: Array,
              value: []
            }
          }
        }

        connectedCallback () {
          super.connectedCallback()
          this._fetchContent()
          // this._db = new PouchDB('devfest-landing-page', {auto_compaction: true})
          // this._fetchContent()
        }

        disconnectedCallback () {
          // this._db.close()
        }

        _fetchContent () {
          fetch(`https://raw.githubusercontent.com/gdgphilippines/devfestph2017-files/old-master/content/${this.nodeName.toLowerCase()}.md`)
          .then(res => {
            return res.text()
          })
          .then(body => {
            const contentArray = body.split('-----')
            contentArray.forEach(contentBody => {
              if (contentBody.trim()) {
                try {
                  const array = contentBody.split('=====')
                  const query = array[0].trim().split(':')[0].trim()
                  const type = array[0].trim().split(':')[1]
                  const content = array[1]
                  const node = this.shadowRoot.querySelector(query)
                  if (type && type.trim() === 'json') {
                    var prop = query
                    if (!prop) throw new Error('No property found: ' + array[0])
                    // console.log(content, prop, JSON.parse(content))
                    this._setProperty(prop, JSON.parse(content))
                    // console.log(this[prop])
                  } else if (node) {
                    node.innerHTML = marked(content)
                  }
                } catch (e) {
                  console.log(e, contentBody)
                }
              }
            })
          })
        }
      }

      window.customElements.define(DevfestCallForSpeakersPage.is, DevfestCallForSpeakersPage)
    })()
  </script>
</dom-module>
